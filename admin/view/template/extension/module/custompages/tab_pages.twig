<div class="row">
  <div class="col-md-9">
    <div style="margin-bottom: 20px; text-align: right;">
      <a href="{{ module.url_module_form }}" class="btn btn-success btn-sm isl-mr-10"><i class="fa fa-plus isl-mr-5"></i> {{ text_add }}</a>
      <a class="btn btn-primary btn-sm" data-list-refresh data-toggle="tooltip" title="Refresh list"><i class="fa fa-refresh"></i></a>
    </div>

    <table class="table table-striped table-hover items-list">
      <thead>
        <tr>
          <th class="text-center" style="width:45px">{{ text_id }}</th>
          <th class="text-left" style="min-width:200px">{{ text_title }}</th>
          <th class="text-left" style="width:200px">{{ text_layouts }}</th>
          <th class="text-center" style="width:70px">{{ text_status }}</th>
          <th class="text-center" style="width:100px">{{ text_action }}</th>
        </tr>
      </thead>
      <tbody id="custompages-list"><tr><td class="list-no-content" colspan="5">{{ text_loading }}</td></tr></tbody>
    </table>

    <div class="row pagination-wrapper">
      <div class="col-sm-7 pagination-number"></div>
      <div class="col-sm-5 text-right pagination-info"></div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="panel panel-default">
      <div class="panel-heading">{{ text_information }}</div>
      <div class="panel-body">
        <ul class="isl-list">
          {% for info in text_info_custompage_list %}
            <li>{{ info }}</li>
          {% endfor %}
        </ul>
      </div>
    </div>
  </div>
</div>

<script>
var urlList   = 'index.php?route={{ module.path }}/itemList&{{ module.url_token }}',
    urlUpdate = 'index.php?route={{ module.path }}/itemUpdate&{{ module.url_token }}';

$(document).ready(function()
{
  fetchList(urlList);
  $('[data-list-refresh]').on('click', function() {
    fetchList(urlList);
  });
  $('.pagination-number').on('click', 'a', function(e) {
    e.preventDefault();
    fetchList($(this).attr('href'));
  });

  $('#custompages-list').on('click', '[data-isl-update]', function(e) {
    e.preventDefault();

    var el = $(this),
        elData = el.data('isl-update');

    $.ajax({
      url: urlUpdate + '&_='+ new Date().getTime(),
      type: 'POST',
      dataType: 'json',
      data: elData,
      cache: false,
      beforeSend: function() {
        if (elData.action == 'delete') {
          if (!confirm('{{ text_confirm_delete }}')) {
            return false;
          }
          el.after('<i class="fa fa-spinner fa-spin spinner-id-' + elData.id + '"></i>');
        }
      },
      success: function(data) {
        if (!data.error) {
          fetchList(urlList);
        } else {
          alert(data.error_message);
          fetchList(urlList);
        }
      }
    });
  })
});

function fetchList(url) {
  $.ajax({
    url: url + '&_='+ new Date().getTime(),
    type: 'POST',
    dataType: 'json',
    cache: false,
    beforeSend: function() {
      $('#custompages-list').html('<tr><td class="list-no-content" colspan="5"><i class="fa fa-spinner fa-spin"></i> {{ text_processing }}</td></tr>');
    },
    success: function(data) {
      $('#custompages-list').html(data.output);

      if (data.pagination) {
        $('.pagination-wrapper').show();
        $('.pagination-number').html(data.pagination);
        $('.pagination-info').html(data.pagination_info);
      } else {
        $('.pagination-wrapper').hide();
      }
    }
  });
}
</script>
